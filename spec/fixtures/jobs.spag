require 'active_support/core_ext/numeric/bytes'
require 'active_support/core_ext/numeric/time'
I18n.enforce_available_locales = false

job test: 'Test Job' do |j|
  j.directory = File.expand_path('..', __FILE__)
  j.environment = {
      QUEUE: '*',
      TERM_CHILD: 1,
      PIDFILE: -> p { p.pidfile }
  }
  j.command = 'rake resque:work'
  j.initial_processes = 2
  j.allowed_processes = 1..3
  j.stdout = File.expand_path('../test.out')
  j.stderr = File.expand_path('../test.err')
  j.kill_timeout = 3.seconds

  j.on(:touch, __FILE__) { |p| p.restart! }
  j.on(:memory, :gt, 350.megabytes) { |p| p.restart! }
end
